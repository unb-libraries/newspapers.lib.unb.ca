language: php

services:
  - docker

php:
  - '7.2'

git:
  depth: 1

before_install:
  - curl -Ls https://raw.githubusercontent.com/unb-libraries/dockworker/3.x/scripts/travis/init.sh | bash
  - composer install

script:
  - set -e
  - echo "$DOCKER_CLOUD_USER_PASS" | docker login --username "$DOCKER_CLOUD_USER_NAME" --password-stdin
  - vendor/bin/dockworker local:build-test
  - vendor/unb-libraries/dockworker/scripts/kubectl/init.sh
  - vendor/bin/dockworker image:deploy $TRAVIS_BRANCH
  - vendor/bin/dockworker deployment:logs:check $TRAVIS_BRANCH
  - vendor/unb-libraries/dockworker/scripts/travis/notifyNewRelicDeployment.sh

notifications:
  slack:
    rooms:
      secure: G1t5x6EXnsm6oXvb0gB1eSpl4j1vaJ9jk8tZ0tXkhAbL9xOgKfeMdw9sc7HVA4QBMsDK6ll7a0Pl4GgbmijQ+0K14o8xliSnZmRRpdtjdivh+UYVoHEp9Rpg3a7tSUsG6ckmw9ca1JcxoNCNNjCigTP2I5VgIb6bAHP3vU5EqjqTvgONv85yiSc2RjeQ6RbJdJzim7Y7IZWHc1CNXBUWYgRnnMd3FJ+SH0dNyfJteSa7ijCh7hsB4WSUR/mt/k8Fm3iTW7mVP3yaPtvVNv7U7LKkcE84WcVwTZf4iP8F17LCdSyYNjqVLFFtxkXlsJqXX6zWsEPbPcIlx1A3xgYgEcmlGGVxO8L9suisNofRGDF5x2k2RMBcsTWHmnSTXNwPIW4LzgpKfNTErMv01Y64McE++dCmnsuR+PUAArji+JmGd3qa/FaT5zssrlwd/NEDrfl0ZkVzjdDC+TyUhgNzA0CmvV+GiN4pq0hrBqCZz6ysoCo91wFgrwJdRg+NDeU/1HaRcDzuJse9usWCz0XYqnTN0SnHYLFEqR4ioMtEfY5JjcLCJMoHKVce4hT6d98u7W57L4ybGw4gjkOH4h6x5t6yH4AlGs7QB4x2D8KnU7n8P8lITC9R+9k/wE/4EQGvduDH7V/G+wY4CmHcG0Bs/Zy8Om+RjiDGHsYJgTQ9K/M=
    on_start: always
    on_success: always
