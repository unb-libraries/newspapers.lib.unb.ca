language: php

services:
  - docker

php:
  - '7.1'

cache:
  directories:
    - $HOME/.composer/cache

git:
  depth: 1

env:
  global:
    - SERVICE_NAME=newspapers.lib.unb.ca
    - AMAZON_ECR_REGION=us-east-1
    - DEPLOY_BRANCHES=dev,prod
    - DEPLOYMENT_FINISHED_MARKER=99_report_as_complete
    - DOCKER_UPSTREAM_IMAGE=unblibraries/drupal:8.x-1.x
    - OLD_IMAGES_TO_KEEP=2
    - SERVICE_DEPLOY_PORT=80
    - SERVICE_TEST_UP_PATH=/user

before_install:
  - curl -sSL https://raw.githubusercontent.com/unb-libraries/CargoDock/drupal-8.x-1.x/travis/deploy.sh | sh
  - CargoDock/travis/beforeInstall.sh

before_script:
  - CargoDock/travis/beforeScript.sh

script:
  - CargoDock/travis/testInstance.sh

after_success:
  - CargoDock/travis/afterSuccess.sh

notifications:
  slack:
    rooms:
      secure: JbilIextKvXD5xoDYqRpR38noC3AV1UaLlHVxYKoYT6RLNgS7lBzScB886CKuZ9uuPP2jydLWMTerEun1cR2SNdI3OI9IY6ZwVkISWF1pFELQPxLxmrcwhlrsL2EKzwDMMvHG2Y/g+erciKSRntN0Ibd3XuECHesbOfqpQ1clfJXzUYQpVijYWTYWfoiQcyD/AU2Jbk/TmshHSdlUe1xflBcZRrJfA+YqUC2gSH+OqfAKoadLGm7ktfkC6LC2MgKDiv4OqcfkIksrnxACXt49ra2N7MJhcmJB7BsFZebHExBJ6Loo+p3w2U+TsnBlYiABzZpfaQrYTAVMZFnxGUWaQG//JlgOlMGMVLPu59hCCQ3EoXVHrKSMxYH8BlisyYZvbo5QdLlG8ZMnjG8qF2Z/j4mkcscW3gGGPHiU9GZUv3J184Pf4KZkpvxzBq+I3UuwqKQPkk8gZHTESWZtT+yFvVARYkzJ4UqFYlxWSZ1BkojQQNNQEF35CMJ3i7/roRhp6O39xTXtSssICNXfoZX7Fd9rbzp3Iz18/D33Y8+D1SKRPRag91NMX65cCKEqT01VcWsdJkCY/DovzQeedYty2YttxSBYhJhrEtP98wAnqjfHrp4PDaWbYOdTzymN20IUwbXEAD96Ksfr10Dnvv/IzJz1t2ItPR7SlciQp+XcJY=
    on_start: always
    on_success: always
